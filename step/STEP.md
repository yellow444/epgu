### Полный процесс работы в тестовом контуре с услугой "Предоставление информации о наличии исполнительного производства онлайн"

## 1. Общая информация

| Тестовая среда              | Адрес                                                                                                |
| --------------------------- | ---------------------------------------------------------------------------------------------------- |
| ЕСИА                        | [esia-portal1.test.gosuslugi.ru](https://esia-portal1.test.gosuslugi.ru/)                            |
| ЕПГУ                        | [svcdev-beta.test.gosuslugi.ru](https://svcdev-beta.test.gosuslugi.ru/)                              |
| Технологический портал ЕПГУ | [svcdev-partners.test.gosuslugi.ru](https://svcdev-partners.test.gosuslugi.ru/)                      |
| Технологический портал ЕСИА | [esia-portal1.test.gosuslugi.ru/console/tech/](https://esia-portal1.test.gosuslugi.ru/console/tech/) |

## 2. Регистрация физических лиц и организаций в ЕСИА

### Регистрация физического лица

- Регистрация в [тестовой среде ЕСИА](https://esia-portal1.test.gosuslugi.ru/registration/).
- Ввод личных данных:
  - **ФИО** – вводится полностью без сокращений.
  - **Паспорт** – серия и номер документа.
  - **СНИЛС** – должен быть реальным для корректной работы некоторых сервисов.
  - **Email** – реальный, потребуется для получения сертификатов и общения с Оператором.
  - **Номер телефона** – можно указать реальный и провести подтверждение через SMS.
- Подтверждение учетной записи через центр госуслуг или почту.
- Мониторинг [кода подтверждения](https://esia-portal1.test.gosuslugi.ru/logs/postcodes/).

### Регистрация организации в ЕСИА

- Вход в [тестовую среду ЕСИА](https://esia-portal1.test.gosuslugi.ru/).
- Использование КЭП генерального директора.
- Заполнение заявки с указанием:
  - **ОГРН**.
  - **ИНН**.
  - **Наименование организации**.
- Подключение учетных записей сотрудников.
- Выдача доверенностей на формирование API-ключей.

## 3. Получение тестового сертификата

### Запрос и установка сертификата

- Отправка заявки на [sd@sc.digital.gov.ru](mailto:sd@sc.digital.gov.ru) с заполненной формой.
- Получение PIN-кода, архива с сертификатом и закрытым ключом.
- Установка сертификата в хранилище КриптоПро.
- Проверка корректности сертификата с помощью утилиты certmgr.

## 4. Регистрация информационной системы (ИС)

### Регистрация и настройка ИС

- Регистрация в [Технологическом портале ЕСИА](https://esia-portal1.test.gosuslugi.ru/console/tech).
- Указание мнемоники тестовой ИС.
- Загрузка сертификата.
- Отправка заявки на [sd@sc.digital.gov.ru](mailto:sd@sc.digital.gov.ru).

## 5. Получение тестового API-ключа

### Запрос API-ключа

- Добавление сотрудника с полномочиями.
- Подача заявки в разделе [Мои системы](https://svcdev-partners.test.gosuslugi.ru/systems).
- Скачивание ключа в формате CSV.

## 6. Настройка взаимодействия с API Госуслуг

### Получение токена доступа

- Запрос `access_token` через OAuth 2.0.
- Проверка валидности токена тестовым запросом.

### Настройка сертификатов и безопасности

- Установка КриптоПро и подключение КЭП.
- Настройка сервиса штампов времени (`TSA`).
- Валидация подписей в тестовой среде.

## 7. Работа с заявками на предоставление услуги

### Формирование и отправка XML-запроса

- Создание XML-документа в соответствии с XSD-схемой.
- Подписание XML-документа КЭП и проверка подписи.
- Отправка запроса через API (`POST /api/gusmev/push/chunked`).
- Получение номера заявки (`orderId`).

## 8. Обработка ответов

### Получение статуса и загрузка ответа

- Запрос `POST /api/gusmev/order/{orderId}`.
- Запрос `GET /download_file/{objectId}/{objectType}`.
- Логирование запросов и обработка ошибок API.

## 9. Интеграция с фронтендом и бэкендом

### Простой интерфейс (React)

- **Форма подачи заявлений** с drag-and-drop загрузкой файлов.
- **Редактор XML** с поддержкой форматирования и предварительного просмотра.
- **Выбор и управление сертификатами** – загрузка, выбор, отображение данных.
- **Отображение статуса запроса** в реальном времени.

### Работа с бэкендом (FastAPI)

- **Авторизация и токены** – работа с JWT и API-ключами.
- **Запросы к Госуслугам** – передача данных, управление заказами.
- **Файловый менеджер** – загрузка и скачивание документов, проверка ZIP-архива.
- **Сертификаты** – валидация, работа с КЭП, настройка подписей.

## 10. Выход в продуктивную среду

### Тестирование и развертывание

- Интеграционные тесты, проверка стабильности работы.
- Совместное тестирование с Оператором.
- Анализ логов и устранение ошибок.

### Запуск в эксплуатацию

- Мониторинг API-запросов.
- Подключение пользователей и распределение ролей.
- Настройка системы логирования и обработки инцидентов.

### Развертывание через Docker

- Использование `docker-compose.yml` для запуска сервисов API и фронтенда.
- Автоматизация развертывания через контейнеризацию.
- Настройка переменных окружения (`.env`).

Эти шаги обеспечивают полное подключение, настройку, тестирование и развертывание системы интеграции с API Госуслуг.

## 11. Заключение

### Использование БД

- Пока не реализовано подключение и работа с БД.
- Для долговременного хранения MongoDB или Postgres, размер хранилища не представляеться большого размера если только не хранить файлы.
- Как минимум в БД можно держать схемы xml и их схемы валидации. Это позволит исключить работу с файлами напрямую. И упростит настройку контейнеров.
- Создать Helm Chart ускорения и упрощения развертывания
- Создать docker image all-in-one
